<!doctype html>
<html>
<body>
<h2>Letter Rush WebSocket Test</h2>
<button id="connect">Connect</button>
<button id="send">Send Progress</button>
<pre id="log"></pre>

<!-- SockJS and STOMP libraries -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
    let stompClient = null;
    const roomId = "demo-room";

    function log(msg) {
      document.getElementById("log").textContent += msg + "\n";
    }

    document.getElementById("connect").onclick = () => {
      const socket = new SockJS("http://localhost:8080/letter-rush");
      stompClient = Stomp.over(socket);

      stompClient.connect({}, (frame) => {
        log("Connected: " + frame);
        stompClient.subscribe(`/topic/room/${roomId}/progress`, (message) => {
          log("Received: " + message.body);
        });
      });
    };

    document.getElementById("send").onclick = () => {
      if (!stompClient) {
        log("Not connected yet!");
        return;
      }
      const progress = {
        playerId: "tester",
        charIndex: Math.floor(Math.random() * 100),
        errors: 0,
        wpm: Math.floor(Math.random() * 120),
        accuracy: 100
      };
      stompClient.send(`/app/room/${roomId}/progress`, {}, JSON.stringify(progress));
      log("Sent: " + JSON.stringify(progress));
    };
</script>
</body>
</html>
